<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="renderer" content="webkit"> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Eyou个人电子邮箱系统</title>
<meta name="description" content="Eyou个人电子邮件系统" />
<meta name="keywords" content="Eyou个人电子邮件系统" />
<style>
*{
	 margin:0; 
	 padding:0;
}
body{ 
	font-family:"微软雅黑",Verdana, Geneva, sans-serif; 
	font-size:12px; 
	background:#fff;
}
.t{ 
	height:150px; 
	line-height:235px; 
	overflow:hidden;
}
a{ 
	outline:none;
}
.h{ 
	width:964px; 
	margin:0 auto;
}
.logo{ 
	padding-top:50px; 
	float:left;
}
.help{ 
	float:right; 
	font-size:14px; 
	font-weight:700; 
	color:#787878; 
	text-decoration:none;
}
.help:hover{
	 text-decoration:underline;
}

.con { 
	width:100%; 
	height:530px;
	background:#a3b9eb;
	padding-top: 62px;
    box-sizing: border-box;
}
.c{ 
	width:964px; 
	height:397px; 
	margin:0 auto; 
	background:url(/tpl/login/user/images/banner01.png) no-repeat; 
	position:relative;
}
ul{ 
	list-style:none;
}

.box{
	 width:389px;
	 position:absolute; 
	 box-shadow:0 0 5px rgba(0,0,0,0.4);
	 border-radius:5px;
}
.text_item{
	height:38px; 
	line-height:38px; 
	width:292px; 
	margin:15px 0 25px 0;
}

.text{
	 height:36px; 
	 line-height:36px;
	 outline:none; 
	 font-size:20px;
	 width:306px;
	 border:1px solid #c7c7c7; 
	 background:#fff; 
	 border-radius:2px; 
	 padding:0 5px; 
	 font-family:"微软雅黑";
	 border-radius:5px;
	 padding-left: 40px;
     box-sizing: border-box;
}
.bl{
	color:#999; 
	width:306px; 
	overflow:hidden; 
	position:relative; 
	top:-3px; 
	font-size:14px;
}
.bl a{
	 color:#999; 
	 text-decoration:none;
}
.bl a:hover{
	 color:#333; 
	 text-decoration:underline;
}
.bl input{
	 position:relative; 
	 top:2px; 
	 opacity:0.7;
}

.tab{
	 overflow:hidden;
	 border-top-left-radius:5px;
	 border-top-right-radius:5px;

}

.tab li{
    height:40px;
    line-height:40px;
    float:left;
    width:50%;
    text-align:center;
    color:#333;
    font-size:16px;
    cursor:pointer;
    font-weight:bold;
	background:#e9e9e9;
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#c8000000,endColorstr=#c8000000);
}
.tab li.current{
    background: rgba(255,255,255,0.8);
}
.tab li.dragbar{
	 width:20px; 
	 background:url(/tpl/login/user/images/dragbar.png); 
	 cursor:move;
}


.boxc{
	padding:20px 0 30px 42px;
    height:256px;
	background:rgba(255,255,255,0.8);
	border-bottom-left-radius:5px;
	border-bottom-right-radius:5px;
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#c8000000,endColorstr=#c8000000);
	
}
.pop{
	 border:1px solid #0167ff; 
	 position:absolute; 
	 width:304px; 
	 background:#fff; 
	 border-top:none;
	 z-index:100; 
	 border-radius:0 0 2px 2px; 
	 box-shadow:0 2px 3px rgba(0,0,0,0.4); 
	 left:42px; 
	 top:111px; 
	 z-index:1000;
}
.pop a{
	 overflow:hidden;
	 display:block;
	 height:34px;
	 line-height:34px; 
	 font-size:14px; 
	 color:#666; 
	 margin:0 5px; 
	 font-weight:700; 
	 text-decoration:none;
}
.pop p:hover{
	 background:#f6f6f6;
}
.pop p:first-child a{
	 border-top:1px dotted #eee;
}
.pop p.first{
	 color:#000; 
	 background:#b5c6e6;
}

.fp{
	 position:absolute; 
	 right:0; 
	 top:-14px; 
	 line-height:12px; 
	 text-decoration:none; 
	 color:#333;
}
.fp:hover{
	 text-decoration:underlined; 
	 color:#333;
}
.yzm{
	 float:right;
	 display:block; 
	 height:38px; 
	 background:#eee; 
	 width:135px;
}
.yzmbox{
	 position:absolute; 
	 height:38px; 
	 width:112px; 
	 background:#eee; 
	 right:-12px; 
	 top:0px;
}
a.zc{
	 font-weight:700; 
	 color:#f60;
}
a.zc:hover{
	color:#f60;
}
.showpassword{
	 position:absolute; 
	 height:18px; 
	 line-height:18px; 
	 right:-1px; 
	 top:38px; 
	 background:#bac5d4; 
	 color:#fff; 
	 padding:0 3px;
}
.showpassword input{
	 position:relative; 
	 top:2px;
}
.btnb{
	margin:20px 0 25px 0; 
	width:292px; 
	position:relative;
}
.btnb a{
	 float:right; 
	 color:#787878; 
	 text-decoration:none;
}
.btnb a:hover{
	 text-decoration:underline;
}
.btn{
	 height:38px; 
	 width:142px; 
	 border:none; 
	 font-size:14px; 
	 color:#fff; 
	 font-weight:400; 
	 backg/round:url(/tpl/login/user/images/login_btn.jpg) 0 0; 
	 font-size:20px; 
	 font-family:"微软雅黑";
}
.btn:hover{
	 background-position:0 -38px;
}
h3{
	 text-align:; 
	 font-size:16px; 
	 padding-right:42px; 
}
.blt{
	 float:right;
}
.msg{
	 position:absolute;
	 background:#cc3300; 
	 color:#fff; 
	 padding:0 10px; 
	 font-size:14px; 
	 top:42px; 
	 height:30px; 
	 line-height:30px; 
	 left:42px; 
	 right:42px; 
	 text-align:center;
}
.user { 
	background:#fff url(/tpl/login/user/images/user.png) no-repeat 10px;
}
.lock { 
	background:#fff url(/tpl/login/user/images/lock.png) no-repeat 13px;
}
.btn { 
	height:34px;
	line-height:34px;
	width:306px;
} 
.btn .submit { 
	background:#4d91d8;
	height:34px;
	line-height:34px;
	border:none;
	width:306px;
	color:#fff;
	margin-top:12px;
	border-radius:5px;
	font-size:18px;
}
.quick_load { 
    padding: 20px 0 30px 42px;
    height:256px;
	background:rgba(255,255,255,0.8);
	border-bottom-left-radius:5px;
	border-bottom-right-radius:5px;
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#c8ffffff,endColorstr=#c8ffffff);

}
.quick_load .switch { 
	float: right;
    font-size: 12px;
    font-weight: 400;
    line-height: 22px;
    color: #4d91d8;
    text-decoration: none;
    padding-right: 20px;
}
.led {
    padding: 20px 0 0 75px;
    font-size: 14px;
    font-weight: 400;
    color: #666;
}
.ewmpic {
    position: relative;
    height: 120px;
    width: 120px;
    padding: 5px;
    border: 1px solid #eee;
    background: #fff;
    margin: 20px 0 0 75px;
    margin-bottom: 10px;
}
.exp {
    position: absolute;
    padding-top: 45px;
    left: 0px;
    right: 0px;
    top: 0px;
    bottom: 0px;
    background: rgba(0,0,0,0.5);
    color: #fff;
    line-height: 190%;
    text-align: center;
}
.ewmpic img {
    width: 120px;
    height: 120px;
}
.ledp {
    width: 200px;
    background: #eee;
    height: 25px;
    line-height: 25px;
    text-align: center;
    border-radius: 13px;
    margin-left: 45px;
}

</style>

<!-- 登录界面普通处理开始 -->
<script type="text/javascript" src="/tpl/public/js/eele.js"></script>
<script type="text/javascript" src="/tpl/public/js/common.js"></script>
<script type="text/javascript" src="/tpl/public/js/url_control.js"></script>
<script type="text/javascript">
eele.include('event');

// {{{ members
var gUrlPrefix = '/';
var isCaptcha = 2;
var code = 0;
var gHasOpenid = 1;
var gHasSecureMail = 0;
//自动完成匹配用的域名列表
var domainList = [];

// 微信的相关配置
var wxQrcodeScanTime = 1000;
var wxQrcodeScanStop = false;
var wxQrcodeScanTryNum = 0;
var wxQrcodeScanTryMaxNum = 10;
var gWxQrcodeId = '';
var wxScanTimeOut = null;

//引入系统配置里面的域列表信息,合并到自动完成的域里面里面。
domainList = ([]).concat(domainList);

var gLockInfo = "";// }}} end members

// {{{ 错误码
var msgTpl = {
    1 : "您填写的用户名或密码错误。",
    2 : "您帐户所在的域已经过期。", 
    3 : "您的帐户已经过期。",
    4 : "您的帐户已经被锁定。",
    5 : "验证码已经过期，请重新输入。",
    6 : "您填写的验证码错误，请重新输入。",
    7 : "模板配置错误。",
    8 : "该用户不允许别名登录。",
    9 : "重试次数太多，用户被锁定。",
    10 : "重试次数太多，IP被锁定，" + gLockInfo + "分钟后再试。", 
    11 : "无效用户,不允许登录",
    12 : "请插入Usbkey或者Usbkey认证失败",
    13 : "手机尚未绑定",
    14 : "手机动态密码过期",
    15 : "手机动态密码不正确"
};
// }}}

// {{{ function showMsgCode()
/**
 * 显示提示
 * @param max c
 * @return void
 */
var showMsgCode = function(c) {
    c = c-0;
    if (c === 0) {
        showMsg();
    } else if (msgTpl[c]) {
        showMsg(msgTpl[c]);
    } else {
        showMsg(msgTpl[1]);
    }
}
// }}}
// {{{ function showMsg()

/**
 * 显示信息提示框
 * @param string msg
 * @return void
 */
var showMsg = function(msg) {
    if (typeof(msg) == 'undefined') {
        document.getElementById('msg').style.display = 'none';
    } else {
        document.getElementById('msg').innerHTML = msg;
        document.getElementById('msg').style.display = '';
    }
}
// }}}
// {{{ function getLoginTo()
var getLoginTo = function() {
    return getCookie('emLoginTo');
}
// }}}
// {{{ function setCookie()
var setCookie = function(k, v) {
    document.cookie = k + '=' + encodeURIComponent(v) + ' ;expires=' + (new Date(
                (new Date()).getTime() + 180*24*3600*1000
                )).toGMTString() + ' ;path=/';
}
// }}}
// {{{ function getCookie()
var getCookie = function(k) {
    var cookieStr = document.cookie;
    if (cookieStr != "") {
        var cookieArr = cookieStr.split(';');
        var everyCookie, cookieKey, cookieValue, splitPos;
        for (i=0; i<cookieArr.length; i++) {
            everyCookie = cookieArr[i].replace(/(^\s*)|(\s*$)/g, '');
            if (everyCookie != "") {
                splitPos = everyCookie.indexOf('=');
                if (splitPos == -1) continue;
                cookieKey = everyCookie.substr(0, splitPos);
                cookieValue = everyCookie.substr(splitPos+1);

                if (cookieKey === k) {
                    return decodeURIComponent(cookieValue);
                }
            }
        }
    }

    return '';
}
// }}}
// {{{ function setLoginTo()
var setLoginTo = function(loginTo) {
    setCookie('emLoginTo', loginTo);
}
// }}}
// {{{ function tabClick()
var tabClick = function(tab, notClear) {
    notClear = !!notClear;
    if (!notClear) {
        showMsg(); 
    }

    if (wxScanTimeOut) { 
        clearTimeout(wxScanTimeOut);
    }

    var c = tab.className;
    var liList = tab.parentNode.getElementsByTagName('li');
    for (var i=liList.length-2; i>=0; i--) {
        liList[i].className = '';
        g('tab_' + liList[i].id).style.display = "none";
    }

    setLoginTo(tab.id);
    tab.className = 'current';
    g('tab_' + tab.id).style.display = "";

    if (tab.id == "via_speedly") {
       eele.fire(document, 'scanqr') ;
    }

}
// }}}
// {{{ function ajax_post()
var ajax_post = function(url, data, success, fail) 
{
    var ajax;
    var toTry = ['XMLHttpRequest', 'Msxml2.XMLHTTP', 'Microsoft.XMLHTTP'];
    for (var i=0; i<toTry.length; i++) {
        try {
            if (i == 0) {
                ajax = new window[toTry[i]]();
            } else {
                ajax = new window.ActiveXObject(toTry[i]);
            }
            break;
        } catch(e) {}
    }
    
    var stateChange = function()
    {
        if(ajax.readyState == 4)
        {
            if (ajax.status >=400) {
                if (typeof(fail) === 'function')
                    fail(ajax.statusText);
            } else if (typeof(success) === 'function') {
                success(ajax.responseText);
            }
        }
    };

    url = url + (url.indexOf('?') > -1 ? '&' : '?') + 'r=' + Math.random();

    ajax.onreadystatechange = stateChange;

    ajax.open('post', url, true);
    ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");

    try {
        ajax.send(data);
    } catch (e) {
        if (typeof(fail) === 'function')
            fail(e);
    }
};
// }}}
// {{{ function on()
var on = function(node, ev, callback) {
    if (!node) return;
    var _callback = function(ev) {
        if (false === callback.apply(node, [ev])) {
            if (ev.preventDefault) {
                ev.preventDefault();
            }
            return false;
        }
    }
    if (node.addEventListener) {
        node.addEventListener(ev, _callback, false);
    } else {
        node.attachEvent('on'+ev, _callback);
    }
}
// }}}
// {{{ function _setPlaceholder()
var _setPlaceholder = function (b) {
    return;
    var a = b.getAttribute("_placeholder");
    if (!a) return;
    if ("placeholder" in b) {
        b.placeholder = a;
        return b;
    }

    var f = false;
    var _b;
    //password补丁
    if (b.type === 'password') {
        f = true;
        _b = document.createElement('input');
        _b.type = 'text';
        _b.style.fontSize =  '20px';
        _b.style.color = "#999";
        _b.value = a;
        _b.className = 'text';
        _b.style.display = 'none';
        b.parentNode.insertBefore(_b, b);
    }
    
    //初始化
    if (f) {
        if (b.value !== '') {
            b.style.display = '';
            _b.style.display = 'none';
        } else {
            b.style.display = 'none';
            _b.style.display = '';
        } 
    } else {
        if (b.value !== "") {
            b.empty = 0;
            b.style.color = "#000";
        } else {
            b.empty = 1;
            b.value = a;
            b.style.color = "#999";
        }
    }
    if (f) {
        on(_b, "focus", function () {
            _b.style.display = 'none';
            b.style.display = '';
            b.focus();
        });
        on(b, "blur", function () {
            if (b.value === "") {
                _b.style.display = '';
                b.style.display = 'none';
            }
        });
    } else {
        on(b, "focus", function () {
            if (this.empty == 1) {
                this.value = "";
                this.style.color = "#000";
            }
        });
        on(b, "blur", function () {
            if (this.empty == 1) {
                this.value = a 
                this.style.color = "#999"; 
            }
        });
        on(b, "change", function () {if (this.value === "") {this.empty = 1;} else {this.empty = 0;}});
        }
    return b;
}
// }}}
// {{{ function window.onload()
window.onload = function() {

    var loginTo = getLoginTo();
    if (loginTo && document.getElementById(loginTo)) {
        tabClick(document.getElementById(loginTo), true);
    } else {
        tabClick(document.getElementById('via_acct'), true);
    }

    // {{{ init
    var _u = getCookie('emLoginUser');
    if (_u) {
        document.getElementById('user').value = _u;
        document.form_login.user.value = _u;
    }
    
    var _m = getCookie('emLoginMobile');
    if (_m) {
        document.getElementById('sms_mobile').value = _m;
        document.form_login2.mobile.value = _m;
    }
    
    var ipts = document.getElementsByTagName('input');
    for (var i=ipts.length-1; i>=0; i--) {
        var type = ipts[i].type;
        if ((type == 'text' || type == 'password') && ipts[i].getAttribute('_placeholder')) {
            _setPlaceholder(ipts[i]);
        }
    }
    // }}}
    // {{{ on.authCode
    //var authCode = document.getElementById('auth_code');
    var authCode = document.form_login.auth_code;
    var authImage = document.getElementById('auth_code_img');
    var timer = 0;
    on(authCode, 'focus', function() {
        if (authImage.innerHTML === '') {
            loadImage();
        }
        clearTimeout(timer);
        authImage.style.display = ''; 
    });
    
    on(authCode, 'blur', function() {
        clearTimeout(timer);
        timer = setTimeout(function() {
            authImage.style.display = 'none'; 
        }, 100);
    });

    var authCode2 = document.getElementById('auth_code2');
    var authImage2 = document.getElementById('auth_code_img2');
    var timer2 = 0;
    on(authCode2, 'focus', function() {
        if (authImage2.innerHTML === '') {
            loadImage2();
        }
        clearTimeout(timer2);
        authImage2.style.display = ''; 
    });
    
    on(authCode2, 'blur', function() {
        clearTimeout(timer2);
        timer2 = setTimeout(function() {
            authImage2.style.display = 'none'; 
        }, 100);
    });
    // }}}
    // {{{ on.authImage
    on(authImage, 'mousedown', function() {
        loadImage();      
        clearTimeout(timer);
        authCode.focus();
        return false;
    });

    on(authImage2, 'mousedown', function() {
        loadImage2();      
        clearTimeout(timer2);
        authCode2.focus();
        return false;
    });

    var loadImage = function() {
        authImage.innerHTML = '<img width=112 height=38 title="点击更换验证码" src="' + "/?q=auth.image&type=login&r=" + Math.random() + '">';
    }

    var loadImage2 = function() {
        authImage2.innerHTML = '<img width=112 height=38 title="点击更换验证码" src="' + "/?q=auth.image&type=sms&r=" + Math.random() + '">';
    }

    // }}}
    // {{{ isCaptcha
    if (isCaptcha == 2) {
        var forceCaptcha = false;
        var showCaptcha = function() {
            //var authCode = document.getElementById('auth_code');
            var authCode = document.form_login.auth_code;
            authCode.style.display = '';
            forceCaptcha = true;
        }

        var hideCaptcha = function() {
            //var authCode = document.getElementById('auth_code');
            var authCode = document.form_login.auth_code;
            authCode.style.display = 'none';
            forceCaptcha = false;
        }

        var changeFun = function() {
            var u = document.getElementById('user').value.replace(/^\s+|\s+$/g, '');
            if (u === '') {
                hideCaptcha();
                return;
            }
            ajax_post('/?q=login.check.captcha', 'user=' + encodeURIComponent(u), function(d) {
                try {
                    var o = eval('(' + d  + ')');
                    if (o.data) {
                        showCaptcha();
                    } else {
                        hideCaptcha();
                    }
                } catch(e) {
                    hideCaptcha();
                }
            });
        };

        on(document.getElementById('user'), 'blur', changeFun);
        changeFun();
    }
    // }}}
    // {{{ function beforeLogin()

    /**
     * 登录前操作
     * @param void
     * @return void
     */
    var beforeLogin = function() {
        var uc1, uc2, fUrl;
        var loginUrl, locationUrl;

        var loginSsl = document.form_login.login_ssl.value;

        uc1 = new UrlControl();
        uc2 = new UrlControl();

        uc1.setUrl(window.location.href);
        fUrl = uc1.getParam("furl");

        var tabs = document.getElementById('tab').getElementsByTagName('li');
        for (var i=0; i<tabs.length-1; i++) {
            if (tabs[i].className === 'current') {
                fUrl = document.form_login.go.value;
            }
        }

        var urlPort1, urlPort2, urlProtocol1, urlProtocol2;
        if ("" === uc1.urlProtocol) {
            urlPort1 = "";
        } else {
            urlProtocol1 = uc1.urlProtocol + "://";
            urlPort1 = "" === uc1.urlPort ? "" : (":" + uc1.urlPort);
        }

        uc2.setUrl(urlProtocol1 + uc1.urlHostname + urlPort1 + uc1.getPath());
        switch (parseInt(loginSsl)) {
            case 1:
                if (document.form_login.login_ssl.checked) {
                    uc2.urlProtocol = 'https'; 
                }
                break;
            case 2:
                uc2.urlProtocol = 'https';//login.do 
                break;
            case 3:
                uc1.urlProtocol = 'https';//q=base 
                uc2.urlProtocol = 'https'; 
                break;
            default:
        }

        if ("" === uc2.urlProtocol) {
            urlPort2 = "";
        } else {
            urlProtocol2 = uc2.urlProtocol  + "://";
            urlPort2 = "" === uc2.urlPort ? "" : (":" + uc2.urlPort);
        }
        
        if ("" === uc1.urlProtocol) {
            urlPort1 = "";
        } else {
            urlProtocol1 = uc1.urlProtocol + "://";
            urlPort1 = "" === uc1.urlPort ? "" : (":" + uc1.urlPort);
        }

        if (fUrl) {
            var uc3 = new UrlControl(); 
            uc3.setUrl(decodeURIComponent(fUrl));
            if (!uc3.urlProtocol) {
                locationUrl =  urlProtocol1 + uc1.urlHostname + urlPort1 + uc3.getPath() + "?" + uc3.getQs();
            } else {
                locationUrl = uc3.getUrl();
            }
        } else {
            locationUrl =  urlProtocol1 + uc1.urlHostname + urlPort1 + uc1.getPath() + "?q=base";
        }

        document.form_login.setAttribute('action', uc2.getUrl() + "?q=login.do");
        document.form_login.referer.value = window.location.href;
        document.form_login.go.value = locationUrl;
    }
    // }}}
    // {{{ function beforeLogin2()

    /**
     * 登录前操作
     * @param void
     * @return void
     */
    var beforeLogin2 = function() {
        var uc1, uc2, fUrl;
        var loginUrl, locationUrl;

        var loginSsl = document.form_login2.login_ssl.value;

        uc1 = new UrlControl();
        uc2 = new UrlControl();

        uc1.setUrl(window.location.href);
        fUrl = uc1.getParam("furl");

        var tabs = document.getElementById('tab').getElementsByTagName('li');
        for (var i=0; i<tabs.length-1; i++) {
            if (tabs[i].className === 'current') {
                fUrl = document.form_login2.go.value;
            }
        }

        var urlPort1, urlPort2, urlProtocol1, urlProtocol2;
        if ("" === uc1.urlProtocol) {
            urlPort1 = "";
        } else {
            urlProtocol1 = uc1.urlProtocol + "://";
            urlPort1 = "" === uc1.urlPort ? "" : (":" + uc1.urlPort);
        }

        uc2.setUrl(urlProtocol1 + uc1.urlHostname + urlPort1 + uc1.getPath());
        switch (parseInt(loginSsl)) {
            case 1:
                if (document.form_login2.login_ssl.checked) {
                    uc2.urlProtocol = 'https'; 
                }
                break;
            case 2:
                uc2.urlProtocol = 'https';//login.do 
                break;
            case 3:
                uc1.urlProtocol = 'https';//q=base 
                uc2.urlProtocol = 'https'; 
                break;
            default:
        }

        if ("" === uc2.urlProtocol) {
            urlPort2 = "";
        } else {
            urlProtocol2 = uc2.urlProtocol  + "://";
            urlPort2 = "" === uc2.urlPort ? "" : (":" + uc2.urlPort);
        }
        
        if ("" === uc1.urlProtocol) {
            urlPort1 = "";
        } else {
            urlProtocol1 = uc1.urlProtocol + "://";
            urlPort1 = "" === uc1.urlPort ? "" : (":" + uc1.urlPort);
        }

        if (fUrl) {
            var uc3 = new UrlControl(); 
            uc3.setUrl(decodeURIComponent(fUrl));
            if (!uc3.urlProtocol) {
                locationUrl =  urlProtocol1 + uc1.urlHostname + urlPort1 + uc3.getPath() + "?" + uc3.getQs();
            } else {
                locationUrl = uc3.getUrl();
            }
        } else {
            locationUrl =  urlProtocol1 + uc1.urlHostname + urlPort1 + uc1.getPath() + "?q=base";
        }

        document.form_login2.setAttribute('action', uc2.getUrl() + "?q=login.sms.do");
        document.form_login2.referer.value = window.location.href;
        document.form_login2.go.value = locationUrl;
    }
    // }}}
    // {{{ loginUsbkey.init()
        // }}}
    // {{{ function onsubmit()
    var onsubmit = function(ev, noAlert) {
        noAlert = !!noAlert;
        showMsg();
        var uNode = document.getElementById('user');
        var u = uNode.value.replace(/^\s+|\s+$/g, '');
    
                    if (u === '' || uNode.empty === 1 || document.form_login.password.value === '') {
                if (!noAlert) {
                    showMsg("请填写用户名和密码。");
                }
                if (u === '' || uNode.empty === 1) {
                    uNode.focus();
                } else {
                    if (document.form_login.password.style.display === 'none') {
                        document.form_login.password.previousSibling.style.display = 'none';
                        document.form_login.password.style.display = '';
                    }
                    document.form_login.password.focus();
                }
                return false;
            }
                document.form_login.user.value = u;

        //如果开启验证码
        if (isCaptcha == 1 || forceCaptcha) {
            if ("" == authCode.value || authCode.empty === 1) {
                if (!noAlert) {
                    showMsg("请填写验证码。"); 
                }

                authCode.focus();
                return false;
            }
        }

                setCookie('emLoginUser', u);
        beforeLogin();
        return true;
    };
    // }}}
    // {{{ function onsubmit2()
    var onsubmit2 = function(ev, noAlert) {
        noAlert = !!noAlert;
        showMsg();
        var uNode = document.getElementById('sms_mobile');
        var u = uNode.value.replace(/^\s+|\s+$/g, '');
        if (u === '' || uNode.empty === 1 || document.form_login2.password.value === '') {
            if (!noAlert) {
                showMsg("请填写手机号和手机动态密码。");
            }
            if (u === '' || uNode.empty === 1) {
                uNode.focus();
            } else {
                document.form_login2.password.focus();
            }
            return false;
        }
    
        document.form_login2.mobile.value = u;

        setCookie('emLoginMobile', u);
        beforeLogin2();
        return true;
    };
    // }}}
    // {{{ on.user.keydown
    on(document.getElementById('user'), 'keydown', function(ev) {
        if (ev.keyCode === 13) {
            setTimeout(function() {
                if (false === onsubmit(null, true)) {
                    return; 
                } else {
                    document.form_login.submit();
                }
            }, 100);
        }
    });
    // }}}
    // {{{ sms bind
    var mobileIpt = document.getElementById('sms_mobile');
    var sendBtn = document.getElementById('sms_send');
    var authCode2 = document.getElementById('auth_code2');
    var timer3 = 0;
    var timeout = 60;
    var c;

    on(sendBtn, 'click', function(ev) {
        if (sendBtn.className.search('sms_disabled') > -1) {
            return false;
        }
        showMsg();
        var phone = mobileIpt.value.replace(/(^\s*)|(\s*$)/g, '');
        if (phone === '') {
            showMsg('请输入您的手机号码');
            return;
        }
        
        if ("" == authCode2.value || authCode2.empty === 1) {
            showMsg("请填写验证码。"); 
            authCode2.focus();
            return false;
        }

        var enableSend = function() {
            clearInterval(timer3);
            sendBtn.innerHTML = '获取短信密码';
            sendBtn.className = 'sms_login';
            authCode2.style.display = '';
            authCode2.value = '';
            loadImage2();
        }
        
        var disableSend1 = function() {
            clearInterval(timer3);
            sendBtn.innerHTML = '获取短信密码';
            sendBtn.className = 'sms_login sms_disabled';
            authCode2.style.display = 'none';
        }
        
        var disableSend2 = function() {
            c = timeout;
            sendBtn.innerHTML = c + '秒后重新发送';
            sendBtn.className = 'sms_login sms_disabled';
            var loop = function() { 
                c--;
                if (c > 0) {
                    sendBtn.innerHTML = c + '秒后重新发送';
                } else {
                    enableSend();
                }
            }
            timer3 = setInterval(loop , 1000);
        }

        disableSend1();

        ajax_post('/?q=login.sms.send', 'mobile=' + encodeURIComponent(phone) + '&code=' + encodeURIComponent(authCode2.value), function(d) {
            try {
                var o = eval('(' + d  + ')');
                if (o.error == "" && o.res == 1) {
                    //等待接收验证码             
                    disableSend2();
                } else {
                    if (o.error != "") {
                        throw o.error;
                    } else {
                        throw "系统错误";
                    }
                }
            } catch(e) {
                showMsg(e);
                enableSend();
            }
        }, function(e) {
            showMsg(e);
            enableSend();
        });
        
    });

    // }}}
    // {{{ on.form_login.submit
    on(document.form_login, 'submit', onsubmit);
    on(document.form_login2, 'submit', onsubmit2);
    //}}}

    showMsgCode(code);

    // {{{  ie_type
        // }}}
    // {{{ function showQrmsg()
    var showQrmsg = function(id, msg) {
        if (typeof(id) == 'undefined') {
            id = 'expire';
        }

        if (typeof(msg) == 'undefined') {
            msg = '二维码过期<br/>请点击刷新';
        }
        document.getElementById(id).style.display = '';
        document.getElementById(id).innerHTML = msg;
    }
    // }}}
    // {{{ function hideQrmsg()
    var hideQrmsg = function(id) {
        if (typeof(id) == 'undefined') {
            id = 'expire';
        }
        document.getElementById(id).style.display = 'none';
    }
    // }}}

    var io = new EmIo({server:'/?q=login.io', 'topic':'qrcode'});

    // {{{ function getQrcode() app_qrcode
    var getQrcode = function() {
        if (!gHasSecureMail) {
            return false;
        }

        hideQrmsg();
        ajax_post('/?q=login.qrcode', 't=req', function(d) {
            var data = eval('(' + d  + ')');
            if (data.res == 0) {
                showQrmsg();
                io.close();
            }  else {
                var qrcodeId = data.data.key;
                var timeout = data.data.timeout;
                var handle = 0;
                document.getElementById('qrcode').src = '/?q=login.qrcode&t=qrcode&cid=' + encodeURIComponent(data.data.cid) + '&r=' + (new Date().getTime());
                io.on(qrcodeId, function(data) {
                    switch(data.res) {
                        case 0://失败
                            showMsg(data.error);
                            break;

                        case 1://已经扫描
                            showMsg(data.info);
                            break;

                        case 2://成功
                            clearTimeout(handle);
                            io.un(qrcodeId);
                            io.close();
                            beforeLogin();
                            setTimeout(function() {
                                window.location.href = document.form_login.go.value;
                            },300);
                            //跳转
                            break;

                        case -1://过期
                            clearTimeout(handle);
                            showQrmsg();
                            io.un(qrcodeId);
                            io.close();
                            break;
                    }
                }); 
    
                handle = setTimeout(function() {
                    io.emit(qrcodeId, {res:-1});         
                }, timeout * 1000);
            }
        }, function() {
            showQrmsg();
            io.close();
        });
    }
    // }}}
    // {{{ on.connected
    io.on('connected', function(client) {
        getQrcode();
    });
    // }}}
    // {{{ function qrcodeRefresh()
    var qrcodeRefresh = function() 
    {
        //hideQrmsg();
        io.connect();
    }
    // }}}
    // {{{ function changeMode()
    var changeMode = function(mode) 
    {
        document.getElementById('mode1').style.display = 'none';
        document.getElementById('mode2').style.display = 'none';

        // 切换标签清理微信循环
        if (wxScanTimeOut) {
            clearTimeout(wxScanTimeOut);
        }

        switch (mode) {
            case 1:
                if (document.getElementById('expire').style.display != 'none') {
                    qrcodeRefresh();
                }
                document.getElementById('mode1').style.display = '';
                break;
            case 2:
                if (!gHasOpenid) {
                    return false;
                }

                if (!wxQrcodeScanStop && document.getElementById('wx_expire').style.display != 'none') {
                    wxQrcodeRefresh();
                }

                document.getElementById('mode2').style.display = '';

                if (!wxQrcodeScanStop) {
                    wxQrcodeScan(gWxQrcodeId)
                }

                break;

            case 0:
                // 此处故意省略break
            default:
                break;
        }
        /*
        if (mode == 1) {
            
        } else {
            document.getElementById('mode1').style.display = 'none';
            document.getElementById('mode0').style.display = '';
        }*/
    }
    // }}}
    // {{{ on.change
    on(document.getElementById('expire'), 'click', qrcodeRefresh);
    eele.on(document, 'scanqr', function() {
            
    if (gHasSecureMail) {
            changeMode(1);      
    }

    if (gHasOpenid) {
            changeMode(2);      
    }
    });
    if (gHasSecureMail) {
        on(document.getElementById('change2'), 'click', function() {
            changeMode(1);      
        });
    }

    if (gHasOpenid) {
        on(document.getElementById('change1'), 'click', function() {
            changeMode(2);      
        });
    }


    // }}}
    // {{{ function getWxQrcode() wx_qrcode

    /**
     * 获取wx的二维码
     * @params boolean startScan
     * @return void
     */
    var getWxQrcode = function(startScan, notCloseMsg) {
     if (typeof(startScan) == 'undefined') {
         startScan = 0;
     }

     notCloseMsg = !!notCloseMsg;


     wxQrcodeScanStop = false;
     wxQrcodeScanTryNum = 0;

    if (!notCloseMsg) {
        hideQrmsg('wx_expire');
        showMsg();
    }

    ajax_post('/?q=login.wxqrcode',
              'action=init&oqrid=' + gWxQrcodeId,
              function(d){
                var data = eval('(' + d  + ')');
                if (data.res == 0) {
                    showQrmsg();
                }  else {
                    var qrcodeId = data.data.qrcode_id;
                    setTimeout(function() {
                        document.getElementById('wxqrcode').src = '/?q=login.wxqrcode&action=get&qrid=' + encodeURIComponent(qrcodeId) + '&r=' + (new Date().getTime());
                    }, 200);
                    gWxQrcodeId = qrcodeId;
                    wxQrcodeScanTryNum = 0;

                    if (startScan == 1) {
                        wxQrcodeScan(qrcodeId);
                    }
                }

            },
            function() {
                showQrmsg();
            });
    }
    // }}}
    // {{{ function wxQrcodeScan()

    /**
     * 扫描微信二维码
     * @param string qrId
     * @return void
     */
    var wxQrcodeScan = function(qrId) {
        wxQrcodeScanStop = true;
        ajax_post('/?q=login.wxqrcode.scan',
            'qrid=' + qrId,
              function(d){
                var data = eval('(' + d  + ')');
                switch (data.res - 0) {
                    case 0: // 失败
                        break;

                       // 此处故意省略break
                    case 4: // 未绑定账户 
                       // 此处故意省略break
                    case 5: // 用户不存在
                       // 此处故意省略break
                    case 6: // 微信认证失败
                        showMsg(data.error);
                        showQrmsg('wx_expire', '扫描错误');
                        break;

                    case 2: // 已扫描
                       wxQrcodeScanStop = false;
                       showMsg(data['data']['info']);

                       if (data['data']['wx_user_info'] != '') {
                         var wxUser = data['data']['wx_user_info'];
                         setTimeout(function() {
                            document.getElementById('wxqrcode').src = wxUser['headimgurl'];
                            showQrmsg('wx_expire', wxUser['nickname']);
                         }, 200);
                       } else {
                           showQrmsg('wx_expire', '已扫描');
                       }
                       break;

                   case 3: // 成功
                       beforeLogin();

                       //跳转
                       setTimeout(function() {
                            window.location.href = document.form_login.go.value;
                       },300);
                       break;

                   case 7: // 取消登陆
                       showMsg();
                       hideQrmsg();
                       getWxQrcode(1);
                       break;

                   case 8: // 签名验证失败
                       showMsg(data.error);
                       showQrmsg('wx_expire', '签名验证失败');
                       break;

                   case 1: // 初始化状态
                       showMsg();
                       hideQrmsg('wx_expire');
                       wxQrcodeScanStop = false;
                       break;

                    case -1: // 过期 
                       showMsg();
                       showQrmsg('wx_expire');
                       break;
                   default:
                       break;
                }

                if (!wxQrcodeScanStop && wxQrcodeScanTryNum < wxQrcodeScanTryMaxNum) {
                    clearTimeout(wxScanTimeOut);
                    wxScanTimeOut = setTimeout(function(){wxQrcodeScan(qrId);}, wxQrcodeScanTime); 
                }

            },
            function() {
                wxQrcodeScanTryNum++;
                showQrmsg();
            });
    }
    // }}}
    // {{{ function wxQrcodeRefresh()
    var wxQrcodeRefresh = function() 
    {
        getWxQrcode(1);
    }
    // }}}

    if (gHasOpenid) {
        getWxQrcode(1 , true);
    }

    on(document.getElementById('wx_expire'), 'click', wxQrcodeRefresh);
                
    changeMode(2);}
// }}}


    // {{{ function _drawDown()

    /**
     * 画下载内容
     * @var void
     * @return void
     */
     var _drawDown = function() {
         var tab = document.getElementById('down_tab');
         var tabItems = document.getElementById('down_tab_items');
         var getCur = 0;

         for (var i in downTab) {
             var tName = downTab[i]['name'];
             var tItems = downTab[i]['items'];

             var cn = '';
             var dis = 'none';

             if (getCur == 0) {
                 var cn = 'current';
                 getCur = 1;
                 lastSelDownTab = i;
                 dis = '';
             }

             // 画tab
             var a = document.createElement('a');
             a.href = 'javascript:void(0);';
             a.className = cn;
             a._key = i;
             a.innerHTML = tName;
             a.id = 'down_tab_' + i;
             a.onmouseover = function() {
                 var _key = this._key;

                 if (lastSelDownTab !== '') {
                     document.getElementById('down_tab_' + lastSelDownTab).className = '';

                     if (document.getElementById('down_tab_items_' + lastSelDownTab)) {
                         document.getElementById('down_tab_items_' + lastSelDownTab).style.display = 'none';
                     }
                 }

                 if (document.getElementById('down_tab_items_' + this._key)) {
                     document.getElementById('down_tab_items_' + this._key).style.display = '';
                 }

                 this.className = 'current';
                 lastSelDownTab = this._key;
             }
             tab.appendChild(a);

             // 画items
             var mainDiv = document.createElement('div');
             mainDiv.id = 'down_tab_items_' + i;
             mainDiv.style.display = dis;
             tabItems.appendChild(mainDiv);

             for (var t in tItems) {
                 var box = document.createElement('div');
                 box.className = 'dbox';
                 mainDiv.appendChild(box);

                 var item = tItems[t];
                 var len = item.length;

                 for (var j = 0; j < len; j++) {
                     var _tn = item[j][0];
                     var _ty = item[j][1];
                     var _tv = item[j][2];
                     var _tc = item[j][3];

                     if (_ty == 'url') {
                         var div = document.createElement('div');
                         div.className = _tc;
                         div._go = _tv;
                         div.onclick = function() {
                             window.open(this._go);
                             return false;
                         }
                         box.appendChild(div);

                         var _a = document.createElement('a');
                         _a.target = '_blank';
                         _a.href = _tv; 
                         _a.innerHTML = _tn;
                         div.appendChild(_a);
                     } else if (_ty == 'code') {
                         var div = document.createElement('div');
                         div.className = _tc;
                         box.appendChild(div);

                         var _a = document.createElement('a');
                         _a.href = 'javascript:void(0);'; 
                         _a.innerHTML = _tn;
                         div.appendChild(_a);

                         var _cdiv = document.createElement('div');
                         _cdiv.className = 'divcode';
                         _cdiv.style.zIndex = '10000';
                         div.appendChild(_cdiv);

                         var _div1 = document.createElement('div');
                         _div1.className = 'arrt';
                         _cdiv.appendChild(_div1);

                         var _div2 = document.createElement('div');
                         _div2.className = 'codec';
                         _div2.innerHTML = '<p>用手机扫描二维码即可立即下载</p>'
                                          + '<div class="ewm"><img src="?q=login&m=qrcode&id=' + _tv + '"/></div>';
                         _cdiv.appendChild(_div2);

                     }
                 }
             }
         }

     }

     // }}} 

//以下代码用来登录退出
//ajax_post('/?q=login.destroy.session');
</script>
<!-- 登录界面普通处理结束 -->
</head>

<body>
<div class="t">
	<div class="h">
    	<div class="logo"><img src="/tpl/login/user/images/logo.jpg" /></div>
        <!--a class="help" href="/?q=help">帮助</a-->
    </div>
</div>

<div class="con">
    <div class="c">
         
    	<div class="box" style="right:60px; top:60px;" id="box">
            <!-- 登录到切换工具栏开始 -->
        	<ul class="tab" id="tab">
            	<!--li class="current">收信</li-->
                <li onclick="tabClick(this)" id='via_acct'>帐号登录</li>
                                <li onclick="tabClick(this)" id='via_speedly'>快捷登录</li>
                                                <li style="display:none" id="dragbar" class="dragbar"></li>
            </ul>
            <!-- 登录到切换工具栏结束 -->
            <!-- 错误信息提示框开始 -->
            <div class="msg" style="display:none" id="msg"></div>
            <!-- 错误信息提示框结束 -->

                                <div id="tab_via_speedly" style="display:none">

               <!-- eYou app扫描登录-->
                <div class="quick_load" style="display:none" id="mode1">
                        <a href="javascript:void(0);" class="switch" style="" id="change1">微信扫描登录</a>
                    <div class="led">安全登录，防止被盗</div>
                    <div class="ewmpic">
                        <div id="expire" class="exp" style="cursor:pointer">二维码过期<br/>请点击刷新</div>
                        <img src="about:blank"  id="qrcode"/>
                    </div>
                    <p class="ledp">使用手机客户端扫描二维码登录</p>
                </div>
               <!-- end eYou app扫描登录-->

               <!-- 微信扫描登录-->
                <div class="quick_load" id="mode2">
                    <a href="javascript:void(0);" class="switch" style="display:none;" id="change2">客户端扫描登录</a>
                    <div class="led">安全登录，防止被盗</div>
                    <div class="ewmpic">
                        <div id="wx_expire" class="exp" style="display:none;cursor:pointer">二维码过期<br/>请点击刷新</div>
                        <img id="wxqrcode"/>
                    </div>
                    <p class="ledp">使用微信扫描二维码登录</p>
                </div>
               <!-- end 微信扫描登录-->
               </div>
                                
               <!-- 短信登录-->
            	<div class="boxc" id="tab_via_sms" style="display:none">
                    <div class="text_item">
                        <input class="text user" id="sms_mobile" type="text" class="text"  autocomplete="off"/>
                        <div id="sms_send" class="sms_login sms_di/sabled ">获取短信密码</div>
                    </div>
                <form name='form_login2' method="post" action="/user/?q=login.sms.do">
                <div class="text_item">
                    <input type="hidden" class="text" name="mobile" value=""/>
                    <input type="password" class="text lock" name="password" />
                </div>
                <div class="bl">
               	 	<span style="float:left">
                                            <input type="hidden" name="login_ssl" value="0" />
                                        </span>
                    <span class="blt">
                                        </span> 
          		</div>
                    <div class="btn">
                    <!-- 登录后的URL控制开始 -->
                        
                        <!-- 登录成功以后跳转的URL -->
                                                <input type="hidden" name="go" value="/?q=base">
                                            
                        <!-- 登录成功失败后跳转的URL -->
                        <input type="hidden" name="referer" value="/?q=login">

                    <!-- 登录后的URL控制结束 -->

                    <!-- 登录按钮 -->
                    <input type="submit"  name="submit" class="submit"  value="登  录"/>
                    </div>
        </form>
               </div>
                <!-- end 短信登录-->
 
               <!-- 账号密码登录-->
            	<div class="boxc" id="tab_via_acct">
                    <div class="text_item">
                    <input type="text" class="text user" id="user" style="ime-mode:disabled" autocomplete="off"  />
                    <div class="pop" style="display:none;" id="pop">
                                            </div>
                    </div>
                <!-- end 账号密码登录-->
                
                <form name='form_login' method="post" action="/user/?q=login.do">
                <div class="text_item">
                    <input type="hidden" class="text" name="user" value=""/>
                    <input type="password" class="text lock" name="password"  />
                </div>

                <div class="btnb">
                    <!-- 验证码控制开始 -->
               		<input type="text" name="auth_code" class="text lock" style="width:170px; float:left;display:none" onfocus="this.className='text_f'" onblur="this.className='text'" id="auth_code"/>
                    <div class="yzmbox" style="display:none" id="auth_code_img" width="113" height="38"></div>
                    <!-- 验证码控制结束 -->

               
                    <div style="clear:both"></div>
                </div>

                <div class="bl">
               	 	<span style="float:left">
                                            <input type="hidden" name="login_ssl" value="0" />
                    		                        </span>
                    <span class="blt">
                    <a href="/?q=resetpw" target="_self">忘记密码</a>                    </span> 
          		</div>
                    <div class="btn">
                    <!-- 登录后的URL控制开始 -->
                        
                        <!-- 登录成功以后跳转的URL -->
                                                <input type="hidden" name="go" value="/?q=base">
                                            
                        <!-- 登录成功失败后跳转的URL -->
                        <input type="hidden" name="referer" value="/?q=login">

                    <!-- 登录后的URL控制结束 -->

                    <!-- 登录按钮 -->
                    <input type="submit"  name="submit" class="submit"  value="登  录"/>
                    </div>
        </form>
               </div>
        </div>
        <div class="f" id="f" style="display:none;">
                </div>
        <div class="login_drag" id="drag_target"></div>
</div>
</br>
</br>
  <div style="text-align: center;" class="cr">
声明：本站非亿邮官网!仅为个人用户提供免费邮箱服务，服务支持请联系support@eyou.com</div>
  </div>
<br>
  <div style="text-align: center;" class="cr">
信网信息技术有限公司&copy;2001-2017版权所有 <a href="http://www.miibeian.gov.cn" target="_blank">津B2-20030010</a>
  </div>
<div  style="text-align:center;margin-top:70px;">
</div>
<script type="text/javascript" src="/tpl/user/public/js/load_cache.js"></script></body>
<!-- 登录界面高级处理开始 -->
<script type="text/javascript" src="/tpl/login/user/js/login.js"></script>

<script type="text/javascript">
if (window.Login) {
    try {
    (new Login()).init();
        } catch(e){}
}


</script>
<!-- 登录界面高级处理结束 -->

</html>
